<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Community - Recipe Posts</title>
    <link rel="icon" th:href="@{/assets/img/favicon/favicon.png}" sizes="32x32">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/assets/css/vendor/gicons.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/animate.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/swiper-bundle.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/bootstrap.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/bootstrap-select.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/owl.carousel.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/owl.theme.default.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/slick.min.css}">
    <link rel="stylesheet" th:href="@{/assets/css/plugins/nouislider.css}">
    <link rel="stylesheet" th:href="@{/assets/css/style.css}" id="main_style">
    <link rel="stylesheet" th:href="@{/assets/css/responsive.css}">
</head>

<body>
<div th:insert="~{fragments/user/header :: header}"></div>

<br>
<br>

<div class="gi-breadcrumb m-b-40">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <nav class="gi-board-tab d-inline-block">
                    <a th:href="@{/community/recipe}" class="mx-3">레시피 게시판</a>
                    <span>|</span>
                    <a th:href="@{/community/info}" class="mx-3">정보 게시판</a>
                    <span>|</span>
                    <a th:href="@{/community/free}" class="mx-3">자유 게시판</a>
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
    .gi-board-tab a {
        color: inherit;
        text-decoration: none;
        font-weight: 500;
    }

    .gi-board-tab a:hover {
        text-decoration: underline;
    }

    .gi-board-tab span {
        margin: 0 4px;
        color: #aaa;
    }

</style>

<br>


<section class="gi-blog padding-tb-40">
    <div class="container">
        <div class="row">
            <!-- 게시글이 없을 때 안내문구 -->
            <div th:if="${postList == null or #lists.isEmpty(postList)}" class="text-center text-muted" style="width:100%;">
                등록된 게시글이 없습니다.
            </div>
            <!-- 카드형 게시글 반복 출력 -->
            <div class="col-md-4 mb-4" th:each="post : ${postList}" th:if="${postList != null and !#lists.isEmpty(postList)}">
                <a th:href="@{/community/{board}/{id}(board='info', id=${post.id})}" style="text-decoration: none; color: inherit;">
                    <div class="card h-100">
                        <img class="card-img-top"
                             th:src="${post.thumbnail != null and !post.thumbnail.isEmpty() ? post.thumbnail : '/assets/img/default.jpg'}"
                             alt="썸네일 이미지"
                             style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h5 class="card-title" th:text="${post.title != null ? post.title : '제목없음'}">제목</h5>
                            <p class="card-text text-muted" style="font-size: 0.95em;">
                                <span th:text="${post.nickname != null ? post.nickname : '익명'}">작성자</span> ·
                                <span th:text="${post.createdAt != null ? #temporals.format(post.createdAt, 'yyyy년 MM월 dd일') : ''}">날짜</span>
                            </p>
                            <div class="d-flex align-items-center mt-2">
                                <span class="me-3">조회수 <span th:text="${post.viewCount != null ? post.viewCount : 0}">0</span></span>
                                <span class="like-btn"
                                      th:classappend="${post.likedByMe != null and post.likedByMe} ? 'liked' : ''"
                                      th:data-post-id="${post.id}">
                                    <i th:class="${post.likedByMe != null and post.likedByMe} ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
                                </span>
                                <span class="ms-1" th:text="${post.likeCount != null ? post.likeCount : 0}">0</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
        </div>

        <!-- 검색창 -->
        <div class="d-flex justify-content-end mb-3">
            <form class="d-flex" method="get" th:action="@{/community/info}">
                <input class="form-control form-control-sm me-2" type="text" name="keyword"
                       th:value="${param.keyword}" placeholder="게시글 검색" style="height: 36px; max-width: 400px;">
                <button class="btn btn-sm btn-outline-dark" type="submit" style="height: 36px;">
                    <i class="gicon gi-search"></i>
                </button>
            </form>
        </div>

        <!-- 페이지네이션 -->
        <div class="d-flex justify-content-center">
            <ul class="pagination">
                <li th:if="${!postPage.first}" class="page-item">
                    <a class="page-link" th:href="@{/community/info(page=${postPage.number - 1}, keyword=${param.keyword})}">이전</a>
                </li>
                <li th:each="num : ${#numbers.sequence(0, postPage.totalPages - 1)}" class="page-item">
                    <a class="page-link" th:href="@{/community/info(page=${num}, keyword=${param.keyword})}"
                       th:classappend="${num == postPage.number} ? 'active'"
                       th:text="${num + 1}">1</a>
                </li>
                <li th:if="${!postPage.last}" class="page-item">
                    <a class="page-link" th:href="@{/community/info(page=${postPage.number + 1}, keyword=${param.keyword})}">다음</a>
                </li>
            </ul>
        </div>
    </div>
</section>


<div th:insert="~{fragments/user/footer :: footer}"></div>

<script th:src="@{/assets/js/plugins/jquery-3.5.1.min.js}"></script>
<script th:src="@{/assets/js/plugins/popper.min.js}"></script>
<script th:src="@{/assets/js/plugins/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/js/plugins/bootstrap-select.min.js}"></script>
<script th:src="@{/assets/js/plugins/swiper-bundle.min.js}"></script>
<script th:src="@{/assets/js/plugins/fontawesome.js}"></script>
<script th:src="@{/assets/js/plugins/owl.carousel.min.js}"></script>
<script th:src="@{/assets/js/plugins/infiniteslidev2.js}"></script>
<script th:src="@{/assets/js/plugins/jquery.zoom.min.js}"></script>
<script th:src="@{/assets/js/plugins/slick.min.js}"></script>
<script th:src="@{/assets/js/plugins/nouislider.js}"></script>
<script th:src="@{/assets/js/plugins/wow.js}"></script>
<script th:src="@{/assets/js/plugins/smoothscroll.min.js}"></script>
<script th:src="@{/assets/js/main.js}"></script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        document.querySelectorAll('.like-btn').forEach(function(btn) {
            btn.addEventListener('click', function(event) {
                event.preventDefault();
                const postId = btn.getAttribute('data-post-id');
                fetch('/likes/toggle/' + postId, {
                    method: 'POST',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest',
                        'X-CSRF-TOKEN': /*[[${_csrf.token}]]*/ ''
                    }
                })
                    .then(res => res.json())
                    .then(data => {
                        btn.classList.toggle('liked', data.liked);
                        const icon = btn.querySelector('i');
                        icon.className = data.liked ? 'fa-solid fa-heart' : 'fa-regular fa-heart';
                        btn.nextElementSibling.textContent = data.likeCount;
                    });
            });
        });
    });
</script>
</body>

</html>