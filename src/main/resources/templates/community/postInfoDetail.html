<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시글 상세</title>
  <link rel="stylesheet" th:href="@{/assets/css/plugins/bootstrap.css}">
  <link rel="stylesheet" th:href="@{/assets/css/style.css}" id="main_style">
  <style>
    .like-btn { cursor: pointer; color: #ff6b81; font-size: 1.5rem; }
    .like-btn.liked { color: red; }
    .comment-box { border-top: 1px solid #ddd; padding-top: 20px; margin-top: 40px; }
  </style>
</head>
<body>

<!-- 공통 헤더 -->
<div th:replace="fragments/user/header :: header"></div>

<section class="gi-blog padding-tb-40">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8">

        <!-- 제목 -->
        <h2 th:text="${post.title}">게시글 제목</h2>

        <!-- 작성자, 날짜 -->
        <div class="text-muted mb-2">
          작성자: <span th:text="${post.nickname}">닉네임</span> |
          작성일: <span th:text="${post.createdAt}">2025-06-25</span> |
          조회수: <span th:text="${post.viewCount}">0</span>
        </div>

        <!-- 썸네일 -->
        <div th:if="${post.thumbnail}">
          <img th:src="${post.thumbnail}" class="img-fluid mb-3" alt="썸네일">
        </div>

        <!-- 내용 -->
        <div class="mb-4" th:utext="${post.content}">
          게시글 내용
        </div>

        <!-- 좋아요 -->
        <div class="mb-4">
          <span id="likeBtn" th:classappend="${post.likedByMe} ? 'liked' : ''" class="like-btn">❤️</span>
          <span id="likeCount" th:text="${post.likeCount}">0</span> 개
        </div>

        <!-- 댓글 -->
        <div class="comment-box">
          <h5>댓글</h5>

          <!-- 댓글 목록 -->
          <div th:each="comment : ${post.comments}">
            <div class="border p-2 mb-2">
              <strong th:text="${comment.nickname}">댓글 작성자</strong>
              <span class="text-muted" th:text="${comment.createdAt}">2025-06-25</span>
              <p th:text="${comment.content}">댓글 내용</p>
            </div>
          </div>

          <!-- 댓글 작성 -->
          <form th:action="@{/comments}" method="post" class="mt-4">
            <input type="hidden" name="postId" th:value="${post.id}">
            <div class="form-group">
              <textarea name="content" class="form-control" rows="3" placeholder="댓글을 입력하세요" required></textarea>
            </div>
            <div class="text-end mt-2">
              <button type="submit" class="btn btn-sm btn-primary">댓글 작성</button>
            </div>
          </form>
        </div>

        <!-- 뒤로가기 -->
        <div class="text-end mt-4">
          <a th:href="@{/community/{board}(board=${post.boardName})}" class="btn btn-secondary">목록으로</a>
        </div>

      </div>
    </div>
  </div>
</section>

<!-- 공통 푸터 -->
<div th:replace="fragments/user/footer :: footer"></div>

<!-- JS -->
<script th:src="@{/assets/js/plugins/bootstrap.bundle.min.js}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const likeBtn = document.getElementById('likeBtn');
    const likeCount = document.getElementById('likeCount');
    const postId = /*[[${post.id}]]*/ 0;

    likeBtn.addEventListener('click', () => {
      fetch(`/likes/toggle/${postId}`, {
        method: 'POST',
        headers: { 'X-CSRF-TOKEN': /*[[${_csrf.token}]]*/ '' }
      })
              .then(res => res.json())
              .then(data => {
                likeBtn.classList.toggle('liked', data.liked);
                likeCount.textContent = data.likeCount;
              });
    });
  });
</script>

</body>
</html>